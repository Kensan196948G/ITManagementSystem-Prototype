{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{useAuth}from'../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MicrosoftAuth=()=>{const navigate=useNavigate();const{loginWithMicrosoft}=useAuth();const[loading,setLoading]=useState(true);const[error,setError]=useState('');// Microsoft認証設定\nconst msAuthConfig={clientId:process.env.REACT_APP_MS_CLIENT_ID||'12345678-1234-1234-1234-123456789012',// 環境変数から取得、またはテスト用の代替ID\nredirectUri:'https://localhost:5000/auth/callback',// Azure portalで設定されたリダイレクトURIに合わせる\nauthority:`https://login.microsoftonline.com/${process.env.REACT_APP_MS_TENANT_ID||'common'}`,// テナントIDを使用\nscopes:['openid','profile','email','User.Read']};// コンポーネントマウント時にMicrosoft認証を開始\nuseEffect(()=>{const startAuth=async()=>{try{// Microsoft認証URLを構築\nconst authUrl=new URL(`${msAuthConfig.authority}/oauth2/v2.0/authorize`);authUrl.searchParams.append('client_id',msAuthConfig.clientId);authUrl.searchParams.append('response_type','code');authUrl.searchParams.append('redirect_uri',msAuthConfig.redirectUri);authUrl.searchParams.append('scope',msAuthConfig.scopes.join(' '));authUrl.searchParams.append('response_mode','query');authUrl.searchParams.append('state',btoa(JSON.stringify({timestamp:new Date().getTime()})));// 開発モードではログインをシミュレート\nconsole.log('Microsoft認証URL:',authUrl.toString());// 開発用: 認証成功をシミュレート\nconst success=await loginWithMicrosoft();if(success){navigate('/dashboard');}else{setError('認証に失敗しました。もう一度お試しください。');setLoading(false);}}catch(err){console.error('認証エラー:',err);setError('認証処理中にエラーが発生しました。もう一度お試しください。');setLoading(false);}};startAuth();},[loginWithMicrosoft,navigate,msAuthConfig]);return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-white py-12 px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md w-full text-center\",children:loading?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center mb-4\",children:/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin h-12 w-12 text-blue-600\",xmlns:\"http://www.w3.org/2000/svg\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]})}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-2\",children:\"Microsoft\\u8A8D\\u8A3C\\u51E6\\u7406\\u4E2D...\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"\\u3057\\u3070\\u3089\\u304F\\u304A\\u5F85\\u3061\\u304F\\u3060\\u3055\\u3044\"})]}):/*#__PURE__*/_jsxs(\"div\",{children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4\",children:error}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/login'),className:\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700\",children:\"\\u30ED\\u30B0\\u30A4\\u30F3\\u30DA\\u30FC\\u30B8\\u306B\\u623B\\u308B\"})]})})});};export default MicrosoftAuth;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useAuth","jsx","_jsx","jsxs","_jsxs","MicrosoftAuth","navigate","loginWithMicrosoft","loading","setLoading","error","setError","msAuthConfig","clientId","process","env","REACT_APP_MS_CLIENT_ID","redirectUri","authority","REACT_APP_MS_TENANT_ID","scopes","startAuth","authUrl","URL","searchParams","append","join","btoa","JSON","stringify","timestamp","Date","getTime","console","log","toString","success","err","className","children","xmlns","fill","viewBox","cx","cy","r","stroke","strokeWidth","d","type","onClick"],"sources":["F:/kitting/ITManagementSystem/frontend/src/pages/MicrosoftAuth.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\nconst MicrosoftAuth = () => {\r\n  const navigate = useNavigate();\r\n  const { loginWithMicrosoft } = useAuth();\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  // Microsoft認証設定\r\n  const msAuthConfig = {\r\n    clientId: process.env.REACT_APP_MS_CLIENT_ID || '12345678-1234-1234-1234-123456789012', // 環境変数から取得、またはテスト用の代替ID\r\n    redirectUri: 'https://localhost:5000/auth/callback', // Azure portalで設定されたリダイレクトURIに合わせる\r\n    authority: `https://login.microsoftonline.com/${process.env.REACT_APP_MS_TENANT_ID || 'common'}`, // テナントIDを使用\r\n    scopes: ['openid', 'profile', 'email', 'User.Read']\r\n  };\r\n\r\n  // コンポーネントマウント時にMicrosoft認証を開始\r\n  useEffect(() => {\r\n    const startAuth = async () => {\r\n      try {\r\n        // Microsoft認証URLを構築\r\n        const authUrl = new URL(`${msAuthConfig.authority}/oauth2/v2.0/authorize`);\r\n        authUrl.searchParams.append('client_id', msAuthConfig.clientId);\r\n        authUrl.searchParams.append('response_type', 'code');\r\n        authUrl.searchParams.append('redirect_uri', msAuthConfig.redirectUri);\r\n        authUrl.searchParams.append('scope', msAuthConfig.scopes.join(' '));\r\n        authUrl.searchParams.append('response_mode', 'query');\r\n        authUrl.searchParams.append('state', btoa(JSON.stringify({ timestamp: new Date().getTime() })));\r\n        \r\n        // 開発モードではログインをシミュレート\r\n        console.log('Microsoft認証URL:', authUrl.toString());\r\n        \r\n        // 開発用: 認証成功をシミュレート\r\n        const success = await loginWithMicrosoft();\r\n        \r\n        if (success) {\r\n          navigate('/dashboard');\r\n        } else {\r\n          setError('認証に失敗しました。もう一度お試しください。');\r\n          setLoading(false);\r\n        }\r\n      } catch (err) {\r\n        console.error('認証エラー:', err);\r\n        setError('認証処理中にエラーが発生しました。もう一度お試しください。');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    startAuth();\r\n  }, [loginWithMicrosoft, navigate, msAuthConfig]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-white py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full text-center\">\r\n        {loading ? (\r\n          <div>\r\n            <div className=\"flex justify-center mb-4\">\r\n              <svg\r\n                className=\"animate-spin h-12 w-12 text-blue-600\"\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <circle\r\n                  className=\"opacity-25\"\r\n                  cx=\"12\"\r\n                  cy=\"12\"\r\n                  r=\"10\"\r\n                  stroke=\"currentColor\"\r\n                  strokeWidth=\"4\"\r\n                />\r\n                <path\r\n                  className=\"opacity-75\"\r\n                  fill=\"currentColor\"\r\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <h2 className=\"text-2xl font-semibold mb-2\">Microsoft認証処理中...</h2>\r\n            <p className=\"text-gray-600\">しばらくお待ちください</p>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            {error && (\r\n              <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => navigate('/login')}\r\n              className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700\"\r\n            >\r\n              ログインページに戻る\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MicrosoftAuth;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,OAAO,KAAQ,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAElD,KAAM,CAAAC,aAAa,CAAGA,CAAA,GAAM,CAC1B,KAAM,CAAAC,QAAQ,CAAGP,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAEQ,kBAAmB,CAAC,CAAGP,OAAO,CAAC,CAAC,CACxC,KAAM,CAACQ,OAAO,CAAEC,UAAU,CAAC,CAAGX,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACY,KAAK,CAAEC,QAAQ,CAAC,CAAGb,QAAQ,CAAC,EAAE,CAAC,CAEtC;AACA,KAAM,CAAAc,YAAY,CAAG,CACnBC,QAAQ,CAAEC,OAAO,CAACC,GAAG,CAACC,sBAAsB,EAAI,sCAAsC,CAAE;AACxFC,WAAW,CAAE,sCAAsC,CAAE;AACrDC,SAAS,CAAE,qCAAqCJ,OAAO,CAACC,GAAG,CAACI,sBAAsB,EAAI,QAAQ,EAAE,CAAE;AAClGC,MAAM,CAAE,CAAC,QAAQ,CAAE,SAAS,CAAE,OAAO,CAAE,WAAW,CACpD,CAAC,CAED;AACAvB,SAAS,CAAC,IAAM,CACd,KAAM,CAAAwB,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,GAAI,CACF;AACA,KAAM,CAAAC,OAAO,CAAG,GAAI,CAAAC,GAAG,CAAC,GAAGX,YAAY,CAACM,SAAS,wBAAwB,CAAC,CAC1EI,OAAO,CAACE,YAAY,CAACC,MAAM,CAAC,WAAW,CAAEb,YAAY,CAACC,QAAQ,CAAC,CAC/DS,OAAO,CAACE,YAAY,CAACC,MAAM,CAAC,eAAe,CAAE,MAAM,CAAC,CACpDH,OAAO,CAACE,YAAY,CAACC,MAAM,CAAC,cAAc,CAAEb,YAAY,CAACK,WAAW,CAAC,CACrEK,OAAO,CAACE,YAAY,CAACC,MAAM,CAAC,OAAO,CAAEb,YAAY,CAACQ,MAAM,CAACM,IAAI,CAAC,GAAG,CAAC,CAAC,CACnEJ,OAAO,CAACE,YAAY,CAACC,MAAM,CAAC,eAAe,CAAE,OAAO,CAAC,CACrDH,OAAO,CAACE,YAAY,CAACC,MAAM,CAAC,OAAO,CAAEE,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC,CAAEC,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,CAE/F;AACAC,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEZ,OAAO,CAACa,QAAQ,CAAC,CAAC,CAAC,CAElD;AACA,KAAM,CAAAC,OAAO,CAAG,KAAM,CAAA7B,kBAAkB,CAAC,CAAC,CAE1C,GAAI6B,OAAO,CAAE,CACX9B,QAAQ,CAAC,YAAY,CAAC,CACxB,CAAC,IAAM,CACLK,QAAQ,CAAC,wBAAwB,CAAC,CAClCF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAE,MAAO4B,GAAG,CAAE,CACZJ,OAAO,CAACvB,KAAK,CAAC,QAAQ,CAAE2B,GAAG,CAAC,CAC5B1B,QAAQ,CAAC,+BAA+B,CAAC,CACzCF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAEDY,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,CAACd,kBAAkB,CAAED,QAAQ,CAAEM,YAAY,CAAC,CAAC,CAEhD,mBACEV,IAAA,QAAKoC,SAAS,CAAC,mFAAmF,CAAAC,QAAA,cAChGrC,IAAA,QAAKoC,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CACzC/B,OAAO,cACNJ,KAAA,QAAAmC,QAAA,eACErC,IAAA,QAAKoC,SAAS,CAAC,0BAA0B,CAAAC,QAAA,cACvCnC,KAAA,QACEkC,SAAS,CAAC,sCAAsC,CAChDE,KAAK,CAAC,4BAA4B,CAClCC,IAAI,CAAC,MAAM,CACXC,OAAO,CAAC,WAAW,CAAAH,QAAA,eAEnBrC,IAAA,WACEoC,SAAS,CAAC,YAAY,CACtBK,EAAE,CAAC,IAAI,CACPC,EAAE,CAAC,IAAI,CACPC,CAAC,CAAC,IAAI,CACNC,MAAM,CAAC,cAAc,CACrBC,WAAW,CAAC,GAAG,CAChB,CAAC,cACF7C,IAAA,SACEoC,SAAS,CAAC,YAAY,CACtBG,IAAI,CAAC,cAAc,CACnBO,CAAC,CAAC,iHAAiH,CACpH,CAAC,EACC,CAAC,CACH,CAAC,cACN9C,IAAA,OAAIoC,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CAAC,4CAAiB,CAAI,CAAC,cAClErC,IAAA,MAAGoC,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAC,oEAAW,CAAG,CAAC,EACzC,CAAC,cAENnC,KAAA,QAAAmC,QAAA,EACG7B,KAAK,eACJR,IAAA,QAAKoC,SAAS,CAAC,qEAAqE,CAAAC,QAAA,CACjF7B,KAAK,CACH,CACN,cACDR,IAAA,WACE+C,IAAI,CAAC,QAAQ,CACbC,OAAO,CAAEA,CAAA,GAAM5C,QAAQ,CAAC,QAAQ,CAAE,CAClCgC,SAAS,CAAC,4DAA4D,CAAAC,QAAA,CACvE,8DAED,CAAQ,CAAC,EACN,CACN,CACE,CAAC,CACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAlC,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}