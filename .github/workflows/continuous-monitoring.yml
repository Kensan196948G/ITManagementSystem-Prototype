name: ðŸ” Continuous System Monitoring & Alerts

on:
  schedule:
    - cron: '*/30 * * * *'  # 30åˆ†ã”ã¨
    - cron: '0 0 * * *'     # æ¯Žæ—¥æ·±å¤œ0æ™‚
  workflow_dispatch:
    inputs:
      monitoring_level:
        description: 'ç›£è¦–ãƒ¬ãƒ™ãƒ«'
        required: true
        default: 'standard'
        type: choice
        options:
        - light      # è»½é‡ç›£è¦–
        - standard   # æ¨™æº–ç›£è¦–  
        - intensive  # é›†ç´„ç›£è¦–
      alert_threshold:
        description: 'ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤'
        required: true
        default: 'medium'
        type: choice
        options:
        - low     # ä½Žãƒ¬ãƒ™ãƒ«
        - medium  # ä¸­ãƒ¬ãƒ™ãƒ«
        - high    # é«˜ãƒ¬ãƒ™ãƒ«

env:
  MONITORING_LEVEL: ${{ github.event.inputs.monitoring_level || 'standard' }}
  ALERT_THRESHOLD: ${{ github.event.inputs.alert_threshold || 'medium' }}

jobs:
  # ðŸ” Phase 1: ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–
  system-monitoring:
    name: ðŸ” System Health Monitoring
    runs-on: ubuntu-latest
    outputs:
      system-status: ${{ steps.monitoring.outputs.system-status }}
      alert-level: ${{ steps.monitoring.outputs.alert-level }}
      issues-detected: ${{ steps.monitoring.outputs.issues-detected }}
      requires-attention: ${{ steps.monitoring.outputs.requires-attention }}
    
    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 1
    
    - name: ðŸ”§ Setup Monitoring Tools
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ðŸ“¦ Install Monitoring Dependencies
      run: |
        npm install -g npm-check lighthouse-ci
        pip install psutil requests
    
    - name: ðŸ” Repository Health Check
      id: repo-health
      run: |
        echo "ðŸ” ãƒªãƒã‚¸ãƒˆãƒªå¥åº·åº¦ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­..."
        
        HEALTH_ISSUES=0
        ALERTS=()
        
        # 1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å¥åº·åº¦
        TOTAL_FILES=$(find . -type f | wc -l)
        LARGE_FILES=$(find . -type f -size +10M | wc -l)
        
        if [ $LARGE_FILES -gt 5 ]; then
          HEALTH_ISSUES=$((HEALTH_ISSUES + 1))
          ALERTS+=("Large files detected: $LARGE_FILES files > 10MB")
        fi
        
        # 2. Gitå¥åº·åº¦
        GIT_STATUS=$(git status --porcelain)
        if [ -n "$GIT_STATUS" ]; then
          UNCOMMITTED_FILES=$(echo "$GIT_STATUS" | wc -l)
          if [ $UNCOMMITTED_FILES -gt 0 ]; then
            ALERTS+=("Uncommitted changes: $UNCOMMITTED_FILES files")
          fi
        fi
        
        # 3. ä¾å­˜é–¢ä¿‚å¥åº·åº¦
        if [ -f package.json ]; then
          # package-lock.jsonã®å­˜åœ¨ç¢ºèª
          if [ ! -f package-lock.json ]; then
            HEALTH_ISSUES=$((HEALTH_ISSUES + 1))
            ALERTS+=("Missing package-lock.json - dependency integrity at risk")
          fi
          
          # node_modulesã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
          if [ -d node_modules ]; then
            NODE_MODULES_SIZE=$(du -sm node_modules | cut -f1)
            if [ $NODE_MODULES_SIZE -gt 500 ]; then
              ALERTS+=("Large node_modules detected: ${NODE_MODULES_SIZE}MB")
            fi
          fi
        fi
        
        # 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–
        if [ -f .env ] && [ -r .env ]; then
          if grep -q "password\|secret\|key\|token" .env; then
            SECRET_COUNT=$(grep -c "password\|secret\|key\|token" .env)
            ALERTS+=("Potential secrets in .env file: $SECRET_COUNT entries")
          fi
        fi
        
        # çµæžœã®è¨˜éŒ²
        echo "repo-health-issues=$HEALTH_ISSUES" >> $GITHUB_OUTPUT
        printf '%s\n' "${ALERTS[@]}" > repo-alerts.txt
        
        echo "ðŸ“Š Repository Health: $HEALTH_ISSUES issues detected"
    
    - name: ðŸ” Performance Monitoring
      if: env.MONITORING_LEVEL != 'light'
      id: performance
      continue-on-error: true
      run: |
        echo "ðŸ” ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›£è¦–å®Ÿè¡Œä¸­..."
        
        PERF_ISSUES=0
        PERF_ALERTS=()
        
        # 1. ãƒ“ãƒ«ãƒ‰æ™‚é–“ç›£è¦–
        BUILD_START=$(date +%s)
        if npm run build; then
          BUILD_END=$(date +%s)
          BUILD_TIME=$((BUILD_END - BUILD_START))
          
          if [ $BUILD_TIME -gt 300 ]; then  # 5åˆ†ä»¥ä¸Š
            PERF_ISSUES=$((PERF_ISSUES + 1))
            PERF_ALERTS+=("Slow build detected: ${BUILD_TIME}s (threshold: 300s)")
          fi
          
          echo "âœ… Build completed in ${BUILD_TIME}s"
        else
          PERF_ISSUES=$((PERF_ISSUES + 1))
          PERF_ALERTS+=("Build failure detected")
          echo "âŒ Build failed"
        fi
        
        # 2. ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºç›£è¦–
        if [ -d dist ]; then
          BUNDLE_SIZE=$(du -sm dist | cut -f1)
          if [ $BUNDLE_SIZE -gt 50 ]; then  # 50MBä»¥ä¸Š
            PERF_ALERTS+=("Large bundle size: ${BUNDLE_SIZE}MB")
          fi
          echo "ðŸ“¦ Bundle size: ${BUNDLE_SIZE}MB"
        fi
        
        # 3. ä¾å­˜é–¢ä¿‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹
        DEPENDENCY_COUNT=$(cat package.json | jq '.dependencies | length' 2>/dev/null || echo "0")
        DEV_DEPENDENCY_COUNT=$(cat package.json | jq '.devDependencies | length' 2>/dev/null || echo "0")
        TOTAL_DEPS=$((DEPENDENCY_COUNT + DEV_DEPENDENCY_COUNT))
        
        if [ $TOTAL_DEPS -gt 100 ]; then
          PERF_ALERTS+=("High dependency count: $TOTAL_DEPS packages")
        fi
        
        echo "performance-issues=$PERF_ISSUES" >> $GITHUB_OUTPUT
        printf '%s\n' "${PERF_ALERTS[@]}" > performance-alerts.txt
        
        echo "ðŸ“Š Performance: $PERF_ISSUES issues detected"
    
    - name: ðŸ” Security Monitoring
      if: env.MONITORING_LEVEL == 'intensive' || env.ALERT_THRESHOLD != 'low'
      id: security
      continue-on-error: true
      run: |
        echo "ðŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–å®Ÿè¡Œä¸­..."
        
        SECURITY_ISSUES=0
        SECURITY_ALERTS=()
        
        # 1. npm auditç›£è¦–
        if npm audit --audit-level=moderate --json > npm-audit-monitoring.json 2>&1; then
          echo "âœ… No security vulnerabilities detected"
        else
          VULN_COUNT=$(cat npm-audit-monitoring.json | jq '.metadata.vulnerabilities.total' 2>/dev/null || echo "0")
          if [ $VULN_COUNT -gt 0 ]; then
            SECURITY_ISSUES=$((SECURITY_ISSUES + VULN_COUNT))
            SECURITY_ALERTS+=("npm security vulnerabilities: $VULN_COUNT")
          fi
        fi
        
        # 2. æ©Ÿå¯†æƒ…å ±ã‚¹ã‚­ãƒ£ãƒ³
        SENSITIVE_FILES=$(find . -name "*.key" -o -name "*.pem" -o -name "*.p12" -o -name "*.jks" 2>/dev/null | wc -l)
        if [ $SENSITIVE_FILES -gt 0 ]; then
          SECURITY_ISSUES=$((SECURITY_ISSUES + 1))
          SECURITY_ALERTS+=("Potentially sensitive files found: $SENSITIVE_FILES")
        fi
        
        # 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
        if [ -f docker-compose.yml ]; then
          if grep -q "password.*admin\|password.*123" docker-compose.yml; then
            SECURITY_ISSUES=$((SECURITY_ISSUES + 1))
            SECURITY_ALERTS+=("Weak passwords detected in docker-compose.yml")
          fi
        fi
        
        # 4. ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ãƒã‚§ãƒƒã‚¯
        EXECUTABLE_CONFIG=$(find . -name "*.json" -o -name "*.yml" -o -name "*.yaml" | xargs ls -la | grep -c "^-rwx" || echo "0")
        if [ $EXECUTABLE_CONFIG -gt 0 ]; then
          SECURITY_ALERTS+=("Configuration files with execute permissions: $EXECUTABLE_CONFIG")
        fi
        
        echo "security-issues=$SECURITY_ISSUES" >> $GITHUB_OUTPUT
        printf '%s\n' "${SECURITY_ALERTS[@]}" > security-alerts.txt
        
        echo "ðŸ“Š Security: $SECURITY_ISSUES issues detected"
    
    - name: ðŸ“Š System Status Assessment
      id: monitoring
      run: |
        echo "ðŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è©•ä¾¡å®Ÿè¡Œä¸­..."
        
        # å„ç›£è¦–çµæžœã®å–å¾—
        REPO_ISSUES=${{ steps.repo-health.outputs.repo-health-issues || '0' }}
        PERF_ISSUES=${{ steps.performance.outputs.performance-issues || '0' }}
        SECURITY_ISSUES=${{ steps.security.outputs.security-issues || '0' }}
        
        TOTAL_ISSUES=$((REPO_ISSUES + PERF_ISSUES + SECURITY_ISSUES))
        
        # ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®æ±ºå®š
        if [ $TOTAL_ISSUES -eq 0 ]; then
          SYSTEM_STATUS="healthy"
          ALERT_LEVEL="none"
          REQUIRES_ATTENTION="false"
        elif [ $TOTAL_ISSUES -le 2 ]; then
          SYSTEM_STATUS="warning"
          ALERT_LEVEL="low"
          REQUIRES_ATTENTION="false"
        elif [ $TOTAL_ISSUES -le 5 ]; then
          SYSTEM_STATUS="degraded"
          ALERT_LEVEL="medium"
          REQUIRES_ATTENTION="true"
        else
          SYSTEM_STATUS="critical"
          ALERT_LEVEL="high"
          REQUIRES_ATTENTION="true"
        fi
        
        # é–¾å€¤ã«ã‚ˆã‚‹èª¿æ•´
        if [ "$ALERT_THRESHOLD" = "low" ]; then
          if [ $TOTAL_ISSUES -gt 0 ]; then
            REQUIRES_ATTENTION="true"
          fi
        elif [ "$ALERT_THRESHOLD" = "high" ]; then
          if [ $TOTAL_ISSUES -lt 5 ]; then
            REQUIRES_ATTENTION="false"
          fi
        fi
        
        # çµæžœã®å‡ºåŠ›
        echo "system-status=$SYSTEM_STATUS" >> $GITHUB_OUTPUT
        echo "alert-level=$ALERT_LEVEL" >> $GITHUB_OUTPUT
        echo "issues-detected=$TOTAL_ISSUES" >> $GITHUB_OUTPUT
        echo "requires-attention=$REQUIRES_ATTENTION" >> $GITHUB_OUTPUT
        
        # ç·åˆãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
        cat > monitoring-summary.json << EOF
        {
          "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
          "system_status": "$SYSTEM_STATUS",
          "alert_level": "$ALERT_LEVEL",
          "total_issues": $TOTAL_ISSUES,
          "requires_attention": $REQUIRES_ATTENTION,
          "monitoring_level": "$MONITORING_LEVEL",
          "alert_threshold": "$ALERT_THRESHOLD",
          "breakdown": {
            "repository": $REPO_ISSUES,
            "performance": $PERF_ISSUES,
            "security": $SECURITY_ISSUES
          }
        }
        EOF
        
        echo "ðŸ“Š System Status: $SYSTEM_STATUS ($TOTAL_ISSUES issues)"
        echo "ðŸš¨ Alert Level: $ALERT_LEVEL"
        echo "âš ï¸ Requires Attention: $REQUIRES_ATTENTION"
    
    - name: ðŸ“¤ Upload Monitoring Data
      uses: actions/upload-artifact@v4
      with:
        name: monitoring-data
        path: |
          monitoring-summary.json
          *-alerts.txt
          npm-audit-monitoring.json
        retention-days: 7

  # ðŸš¨ Phase 2: ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ   
  alert-system:
    name: ðŸš¨ Intelligent Alert System
    runs-on: ubuntu-latest
    needs: system-monitoring
    if: needs.system-monitoring.outputs.requires-attention == 'true'
    permissions:
      contents: read
      issues: write
      discussions: write
    
    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 1
    
    - name: ðŸ“¥ Download Monitoring Data
      uses: actions/download-artifact@v4
      with:
        name: monitoring-data
        path: ./monitoring
    
    - name: ðŸš¨ Create System Alert
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');
          
          // ç›£è¦–ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
          let monitoringData = {};
          try {
            monitoringData = JSON.parse(fs.readFileSync('./monitoring/monitoring-summary.json', 'utf8'));
          } catch (error) {
            console.log('Could not read monitoring data');
          }
          
          // ã‚¢ãƒ©ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
          function readAlertFile(filename) {
            try {
              return fs.readFileSync(`./monitoring/${filename}`, 'utf8').split('\n').filter(line => line.trim());
            } catch {
              return [];
            }
          }
          
          const repoAlerts = readAlertFile('repo-alerts.txt');
          const perfAlerts = readAlertFile('performance-alerts.txt');
          const securityAlerts = readAlertFile('security-alerts.txt');
          
          // ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²
          const alertConfig = {
            'high': { icon: 'ðŸ”´', color: 'red', priority: 'HIGH PRIORITY' },
            'medium': { icon: 'ðŸŸ¡', color: 'orange', priority: 'MEDIUM PRIORITY' },
            'low': { icon: 'ðŸŸ¢', color: 'green', priority: 'LOW PRIORITY' }
          };
          
          const config = alertConfig[monitoringData.alert_level] || alertConfig['medium'];
          
          // Issueä½œæˆ
          const issueBody = `${config.icon} **SYSTEM ALERT - ${config.priority}**
          
          ## ðŸ“Š System Status Summary
          
          - **Status**: ${monitoringData.system_status?.toUpperCase() || 'UNKNOWN'}
          - **Alert Level**: ${config.icon} ${monitoringData.alert_level?.toUpperCase() || 'UNKNOWN'}
          - **Total Issues**: ${monitoringData.total_issues || 0}
          - **Detection Time**: ${monitoringData.timestamp || new Date().toISOString()}
          - **Monitoring Level**: ${monitoringData.monitoring_level || 'standard'}
          
          ## ðŸ” Detected Issues
          
          ### Repository Health
          ${repoAlerts.length > 0 ? repoAlerts.map(alert => `- âš ï¸ ${alert}`).join('\n') : '- âœ… No repository issues'}
          
          ### Performance Issues  
          ${perfAlerts.length > 0 ? perfAlerts.map(alert => `- âš ï¸ ${alert}`).join('\n') : '- âœ… No performance issues'}
          
          ### Security Concerns
          ${securityAlerts.length > 0 ? securityAlerts.map(alert => `- âš ï¸ ${alert}`).join('\n') : '- âœ… No security issues'}
          
          ## ðŸŽ¯ Recommended Actions
          
          ${monitoringData.alert_level === 'high' ? `
          **IMMEDIATE ACTION REQUIRED:**
          - [ ] Review security vulnerabilities immediately
          - [ ] Check system performance metrics
          - [ ] Validate repository integrity
          - [ ] Consider triggering emergency repair workflow
          ` : monitoringData.alert_level === 'medium' ? `
          **ACTION RECOMMENDED:**
          - [ ] Review detected issues
          - [ ] Run auto-repair workflow if needed
          - [ ] Monitor system for escalation
          - [ ] Update dependencies if applicable
          ` : `
          **INFORMATIONAL:**
          - [ ] Review minor issues
          - [ ] Schedule maintenance if needed
          - [ ] Monitor trends
          `}
          
          ## ðŸ¤– Automated Response
          
          - **Auto-Repair**: ${monitoringData.alert_level === 'high' ? 'Will trigger automatically' : 'Available on-demand'}
          - **Self-Healing**: ${monitoringData.system_status === 'critical' ? 'Activated' : 'Standby'}
          - **Monitoring**: Continuous monitoring active
          
          ## ðŸ“Ž Related Data
          
          - **Workflow Run**: [${{ github.run_id }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
          - **Branch**: \`${{ github.ref_name }}\`
          - **Commit**: \`${{ github.sha }}\`
          
          ---
          *Automated alert generated by Continuous System Monitoring v1.0*
          `;
          
          // Issueä½œæˆ
          await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: `${config.icon} System Alert: ${monitoringData.system_status?.toUpperCase() || 'SYSTEM ISSUE'} - ${config.priority}`,
            body: issueBody,
            labels: [
              'system-alert',
              `alert-${monitoringData.alert_level || 'medium'}`,
              `status-${monitoringData.system_status || 'unknown'}`,
              'automated'
            ]
          });
          
          console.log(`Alert created for ${monitoringData.system_status} system status`);
    
    - name: ðŸš¨ Trigger Emergency Repair
      if: needs.system-monitoring.outputs.alert-level == 'high'
      uses: actions/github-script@v7
      with:
        script: |
          // é«˜ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆã®å ´åˆã€ç·Šæ€¥ä¿®å¾©ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼
          await github.rest.actions.createWorkflowDispatch({
            owner: context.repo.owner,
            repo: context.repo.repo,
            workflow_id: 'auto-error-detection-repair.yml',
            ref: 'main',
            inputs: {
              repair_level: 'aggressive',
              target_scope: 'all'
            }
          });
          
          console.log('Emergency repair workflow triggered');

  # ðŸ“Š Phase 3: ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  monitoring-report:
    name: ðŸ“Š Generate Monitoring Report
    runs-on: ubuntu-latest
    needs: [system-monitoring]
    if: always()
    
    steps:
    - name: ðŸ“¥ Download Monitoring Data
      uses: actions/download-artifact@v4
      continue-on-error: true
      with:
        name: monitoring-data
        path: ./monitoring
    
    - name: ðŸ“Š Generate Comprehensive Monitoring Report
      run: |
        mkdir -p reports
        
        # ç›£è¦–ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        SYSTEM_STATUS="${{ needs.system-monitoring.outputs.system-status }}"
        ALERT_LEVEL="${{ needs.system-monitoring.outputs.alert-level }}"
        TOTAL_ISSUES="${{ needs.system-monitoring.outputs.issues-detected }}"
        
        cat > reports/monitoring-report.md << EOF
        # ðŸ” Continuous System Monitoring Report
        
        **ç›£è¦–æ™‚åˆ»**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')  
        **ç›£è¦–ãƒ¬ãƒ™ãƒ«**: ${{ env.MONITORING_LEVEL }}  
        **ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤**: ${{ env.ALERT_THRESHOLD }}  
        **å®Ÿè¡Œãƒˆãƒªã‚¬ãƒ¼**: ${{ github.event_name }}
        
        ## ðŸ“Š System Overview
        
        | ãƒ¡ãƒˆãƒªãƒƒã‚¯ | å€¤ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
        |---------|-----|-----------|
        | ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ | ${SYSTEM_STATUS} | $(if [ "$SYSTEM_STATUS" = "healthy" ]; then echo "ðŸŸ¢ è‰¯å¥½"; elif [ "$SYSTEM_STATUS" = "warning" ]; then echo "ðŸŸ¡ æ³¨æ„"; elif [ "$SYSTEM_STATUS" = "degraded" ]; then echo "ðŸŸ  åŠ£åŒ–"; else echo "ðŸ”´ é‡å¤§"; fi) |
        | ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ« | ${ALERT_LEVEL} | $(if [ "$ALERT_LEVEL" = "none" ]; then echo "âœ… ãªã—"; elif [ "$ALERT_LEVEL" = "low" ]; then echo "ðŸŸ¢ ä½Ž"; elif [ "$ALERT_LEVEL" = "medium" ]; then echo "ðŸŸ¡ ä¸­"; else echo "ðŸ”´ é«˜"; fi) |
        | æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ | ${TOTAL_ISSUES} | $(if [ "$TOTAL_ISSUES" = "0" ]; then echo "âœ… ãªã—"; elif [ "$TOTAL_ISSUES" -lt "3" ]; then echo "ðŸŸ¡ è»½å¾®"; else echo "ðŸ”´ é‡å¤§"; fi) |
        | è¦æ³¨æ„ | ${{ needs.system-monitoring.outputs.requires-attention }} | $(if [ "${{ needs.system-monitoring.outputs.requires-attention }}" = "false" ]; then echo "âœ… ã„ã„ãˆ"; else echo "âš ï¸ ã¯ã„"; fi) |
        
        ## ðŸ“ˆ Monitoring Insights
        
        ### ðŸ¥ System Health
        $(if [ "$SYSTEM_STATUS" = "healthy" ]; then
          echo "âœ… ã‚·ã‚¹ãƒ†ãƒ ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚ã™ã¹ã¦ã®ç›£è¦–é …ç›®ãŒæ­£å¸¸ç¯„å›²å†…ã§ã™ã€‚"
        elif [ "$SYSTEM_STATUS" = "warning" ]; then
          echo "ðŸŸ¡ è»½å¾®ãªå•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸãŒã€ã‚·ã‚¹ãƒ†ãƒ ã¯å®‰å®šã—ã¦ã„ã¾ã™ã€‚ç¶™ç¶šç›£è¦–ä¸­ã§ã™ã€‚"
        elif [ "$SYSTEM_STATUS" = "degraded" ]; then
          echo "ðŸŸ  ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã®ä½Žä¸‹ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚æ”¹å–„æŽªç½®ãŒæŽ¨å¥¨ã•ã‚Œã¾ã™ã€‚"
        else
          echo "ðŸ”´ é‡å¤§ãªã‚·ã‚¹ãƒ†ãƒ å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚å³åº§ã®å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚"
        fi)
        
        ### ðŸ” Detection Coverage
        - **Repository Health**: $(if [ -f monitoring/repo-alerts.txt ]; then echo "ç›£è¦–æ¸ˆã¿"; else echo "ã‚¹ã‚­ãƒƒãƒ—"; fi)
        - **Performance Metrics**: $(if [ -f monitoring/performance-alerts.txt ]; then echo "ç›£è¦–æ¸ˆã¿"; else echo "ã‚¹ã‚­ãƒƒãƒ—"; fi)  
        - **Security Scanning**: $(if [ -f monitoring/security-alerts.txt ]; then echo "ç›£è¦–æ¸ˆã¿"; else echo "ã‚¹ã‚­ãƒƒãƒ—"; fi)
        
        ## ðŸ“… Monitoring Schedule
        
        - **é€£ç¶šç›£è¦–**: 30åˆ†é–“éš”
        - **è©³ç´°ã‚¹ã‚­ãƒ£ãƒ³**: æ¯Žæ—¥ 0:00 UTC
        - **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: ç›£è¦–å®Ÿè¡Œã”ã¨
        - **ã‚¢ãƒ©ãƒ¼ãƒˆ**: é–¾å€¤è¶…éŽæ™‚
        
        ## ðŸŽ¯ Next Steps
        
        $(if [ "${{ needs.system-monitoring.outputs.requires-attention }}" = "true" ]; then
          echo "âš ï¸ **è¦æ³¨æ„**: ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚é–¢é€£ã™ã‚‹Issueã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ä¿®å¾©ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚"
        else
          echo "âœ… **æ­£å¸¸**: ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã¯æ­£å¸¸ã§ã™ã€‚ç¶™ç¶šçš„ãªç›£è¦–ã‚’ç¶­æŒã—ã¾ã™ã€‚"
        fi)
        
        ---
        *Generated by Continuous System Monitoring v1.0*  
        *Next monitoring: $(date -u -d '+30 minutes' '+%Y-%m-%d %H:%M UTC')*
        EOF
        
        echo "ðŸ“Š Monitoring report generated successfully"
    
    - name: ðŸ“¤ Upload Monitoring Report
      uses: actions/upload-artifact@v4
      with:
        name: monitoring-final-report
        path: reports/
        retention-days: 30