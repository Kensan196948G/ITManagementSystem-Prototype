# ITサービス管理システム - 本番環境設定テンプレート
# ===============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ISO 27001/27002 準拠 - 本番環境セキュリティ要件
# ===============================================================================
#
# ⚠️  重要事項 - 本番環境デプロイ前に必須対応:
# 
# 1. 全ての機密値を強力なランダム値に変更
# 2. HTTPS証明書の配置と設定
# 3. データベースSSL接続の有効化
# 4. 外部サービスAPIキーの設定
# 5. 監視・ログ設定の確認
# 6. バックアップ設定の確認
# 7. セキュリティヘッダーの有効化
#
# セキュリティ要件チェックリスト:
# □ JWT_SECRET: 64文字以上のランダム値 (openssl rand -base64 64)
# □ SESSION_SECRET: 32文字以上のランダム値 (openssl rand -base64 32) 
# □ CSRF_SECRET: 32文字以上のランダム値 (openssl rand -base64 32)
# □ DB_PASSWORD: 16文字以上の複雑なパスワード
# □ SSL証明書の配置 (Let's Encrypt推奨)
# □ データベースSSL有効化
# □ セキュリティヘッダー有効化
# □ 監査ログ有効化
# □ バックアップ暗号化設定
#
# ===============================================================================

# ===== アプリケーション基本設定 =====
NODE_ENV=production
APP_NAME="IT Management System"
APP_VERSION=1.0.0
# 本番環境では必ず false
APP_DEBUG=false
# 本番環境では error または warn 推奨
APP_LOG_LEVEL=warn

# ===== サーバー設定 (ISO 27002: 13.2.1 情報転送ポリシー) =====
SERVER_HOST=0.0.0.0
# 本番環境ポート (443 for HTTPS)
SERVER_PORT=443
# 本番環境では必須 (ISO 27002: 13.2.1)
SERVER_HTTPS_ENABLED=true
# SSL証明書パス (Let's Encrypt推奨: /etc/letsencrypt/live/yourdomain.com/)
SERVER_SSL_CERT_PATH=/etc/ssl/certs/itsm.crt
SERVER_SSL_KEY_PATH=/etc/ssl/private/itsm.key
# 本番環境ドメイン (CORS設定)
SERVER_CORS_ORIGIN=https://yourdomain.com
SERVER_BODY_LIMIT=10mb
SERVER_REQUEST_TIMEOUT=15000
# HTTP to HTTPS リダイレクト
SERVER_REDIRECT_HTTP=true
SERVER_HTTP_PORT=80

# ===== データベース設定 (ISO 27002: 13.2.1 暗号化通信) =====
DB_TYPE=postgresql
# 本番データベースホスト
DB_HOST=prod-db.yourdomain.com
DB_PORT=5432
# 本番データベース名
DB_NAME=itsm_production
# 本番DBユーザー (管理者権限は付与しない)
DB_USERNAME=itsm_app_user
# 🔐 CRITICAL: 16文字以上の強力なパスワードに変更必須
DB_PASSWORD=PRODUCTION_STRONG_DB_PASSWORD_MIN_16_CHARS_WITH_SYMBOLS
DB_SCHEMA=public
# 本番環境では必須 (ISO 27002: 13.2.1)
DB_SSL=true
DB_SSL_REJECT_UNAUTHORIZED=true
# SSL証明書検証モード
DB_SSL_MODE=require

# データベース接続プール設定 (本番環境最適化)
DB_POOL_MIN=5
DB_POOL_MAX=50
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_ACQUIRE_TIMEOUT=60000
DB_POOL_CREATE_TIMEOUT=60000
DB_POOL_DESTROY_TIMEOUT=5000

# マイグレーション設定
DB_MIGRATIONS_RUN=false
DB_MIGRATIONS_TABLE=schema_migrations
DB_MIGRATIONS_DIR=./dist/database/migrations

# 本番環境バックアップ設定 (ISO 27002: 12.3.1)
DB_BACKUP_ENABLED=true
# 毎日午前2時にバックアップ実行
DB_BACKUP_SCHEDULE="0 2 * * *"
DB_BACKUP_RETENTION_DAYS=90
DB_BACKUP_PATH=/data/backups/database
# バックアップ暗号化 (必須)
DB_BACKUP_ENCRYPT=true
DB_BACKUP_ENCRYPTION_KEY=PRODUCTION_BACKUP_ENCRYPTION_KEY

# ===== 認証・セキュリティ設定 (ISO 27002: 9.4.2 セキュアログオン) =====
# 🔐 CRITICAL: 以下の値は必ず変更してください - 本番環境では絶対にデフォルト値を使用禁止
# JWT秘密鍵: openssl rand -base64 64
JWT_SECRET=PRODUCTION_JWT_SECRET_BASE64_MIN_64_CHARS_REPLACE_IMMEDIATELY
JWT_EXPIRES_IN=8h
JWT_REFRESH_EXPIRES_IN=24h
# 本番環境では14以上推奨 (ISO 27002: 10.1.1)
BCRYPT_ROUNDS=14

# セッション秘密鍵: openssl rand -base64 32
SESSION_SECRET=PRODUCTION_SESSION_SECRET_BASE64_32_CHARS_REPLACE_NOW
# CSRF保護秘密鍵: openssl rand -base64 32  
CSRF_SECRET=PRODUCTION_CSRF_SECRET_BASE64_32_CHARS_REPLACE_NOW

# Multi-Factor Authentication (本番環境推奨)
MFA_ENABLED=true
MFA_ISSUER_NAME="IT Management System Production"
MFA_SECRET_LENGTH=32
MFA_WINDOW=2
MFA_BACKUP_CODES=10

# セッション設定 (セキュア)
SESSION_STORE=redis
SESSION_MAX_AGE=28800000
# HTTPS必須でセキュアクッキー
SESSION_SECURE=true
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=strict

# OAuth設定 (本番環境用APIキー)
# 🔐 Azure AD / Google Cloud Console から取得した本番環境用の値を設定
OAUTH_GOOGLE_CLIENT_ID=PRODUCTION_GOOGLE_CLIENT_ID_FROM_CLOUD_CONSOLE
OAUTH_GOOGLE_CLIENT_SECRET=PRODUCTION_GOOGLE_CLIENT_SECRET_FROM_CONSOLE
OAUTH_MICROSOFT_CLIENT_ID=PRODUCTION_MICROSOFT_CLIENT_ID_FROM_AZURE_AD
OAUTH_MICROSOFT_CLIENT_SECRET=PRODUCTION_MICROSOFT_SECRET_FROM_AZURE_AD
OAUTH_MICROSOFT_TENANT_ID=PRODUCTION_MICROSOFT_TENANT_ID_FROM_AZURE_AD

# ===== 外部サービス設定 =====
# メール設定 (本番環境SMTP)
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=itsm-noreply@yourdomain.com
# 🔐 メール送信用アプリパスワード
SMTP_PASS=PRODUCTION_SMTP_APP_PASSWORD
SMTP_FROM="IT Management System <itsm-noreply@yourdomain.com>"
EMAIL_TIMEOUT=30000
# メール送信レート制限
EMAIL_RATE_LIMIT_PER_HOUR=100

# ファイルストレージ設定 (本番環境) (ISO 27002: 8.1.3)
STORAGE_TYPE=s3
# 本番環境用S3バケット
STORAGE_AWS_REGION=us-east-1
STORAGE_AWS_BUCKET=itsm-production-storage
# 🔐 本番環境AWS認証情報
STORAGE_AWS_ACCESS_KEY=PRODUCTION_AWS_ACCESS_KEY_ID
STORAGE_AWS_SECRET_KEY=PRODUCTION_AWS_SECRET_ACCESS_KEY
# S3 KMS暗号化キー (必須)
STORAGE_AWS_KMS_KEY_ID=arn:aws:kms:us-east-1:account:key/key-id
STORAGE_MAX_FILE_SIZE=20971520
STORAGE_ALLOWED_EXTENSIONS=jpg,jpeg,png,pdf,doc,docx,xls,xlsx,txt
# 保存時暗号化 (必須)
STORAGE_ENCRYPT_AT_REST=true
STORAGE_VERSIONING_ENABLED=true

# Redis設定 (本番環境)
REDIS_HOST=prod-redis.yourdomain.com
REDIS_PORT=6379
# 🔐 Redis認証パスワード
REDIS_PASSWORD=PRODUCTION_REDIS_AUTH_PASSWORD
REDIS_DB=0
REDIS_TIMEOUT=10000
REDIS_RETRY_DELAY=200
REDIS_RETRY_ATTEMPTS=5
# Redis SSL/TLS (推奨)
REDIS_TLS=true

# ===== API設定 =====
API_BASE_URL=https://api.yourdomain.com/api
API_TIMEOUT=30000
API_RETRY_ATTEMPTS=3
API_RETRY_DELAY=2000
# API キー認証 (外部API用)
API_KEY=PRODUCTION_API_KEY_FOR_EXTERNAL_SERVICES

# レート制限設定 (本番環境厳格化)
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX_REQUESTS=50
RATE_LIMIT_SKIP_SUCCESS=false
# DDoS保護
RATE_LIMIT_SKIP_FAILED_REQUESTS=false
RATE_LIMIT_STORE=redis

# ===== ログ設定 (ISO 27002: 12.4.1 ログ記録) =====
LOG_LEVEL=warn
LOG_FORMAT=json
LOG_FILE_ENABLED=true
LOG_FILE_PATH=/var/log/itsm/app.log
LOG_FILE_MAX_SIZE=50m
LOG_FILE_MAX_FILES=30
LOG_CONSOLE_ENABLED=false
LOG_ERROR_FILE=/var/log/itsm/error.log
# 監査ログ (必須)
LOG_AUDIT_ENABLED=true
LOG_AUDIT_FILE=/var/log/itsm/audit.log
# セキュリティイベントログ
LOG_SECURITY_ENABLED=true
LOG_SECURITY_FILE=/var/log/itsm/security.log
# ログローテーション
LOG_ROTATION_ENABLED=true
LOG_ROTATION_MAX_SIZE=100m
LOG_ROTATION_MAX_FILES=90

# ===== 監視・メトリクス設定 (ISO 27002: 12.6.1) =====
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH=/metrics
# Prometheusエンドポイント認証
METRICS_AUTH_ENABLED=true
METRICS_AUTH_TOKEN=PRODUCTION_METRICS_AUTH_TOKEN

HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
# アプリケーション性能監視 (APM)
APM_ENABLED=true
APM_SERVICE_NAME=itsm-production
APM_SERVER_URL=https://apm.yourdomain.com

# ===== 機能フラグ設定 =====
FEATURE_USER_REGISTRATION=false
FEATURE_EMAIL_VERIFICATION=true
FEATURE_TWO_FACTOR_AUTH=true
FEATURE_AUDIT_LOG=true
FEATURE_NOTIFICATIONS=true
FEATURE_ANALYTICS=true
FEATURE_AUTO_BACKUP=true
# 本番環境のみの機能
FEATURE_ADVANCED_SECURITY=true
FEATURE_COMPLIANCE_REPORTING=true

# ===== キャッシュ設定 =====
CACHE_TYPE=redis
CACHE_TTL=1800
CACHE_MAX_SIZE=1000
CACHE_REDIS_PREFIX=itsm:prod:
# キャッシュ暗号化
CACHE_ENCRYPT=true

# ===== 通知設定 (本番環境) =====
NOTIFICATION_EMAIL_ENABLED=true
NOTIFICATION_SMS_ENABLED=true
NOTIFICATION_PUSH_ENABLED=true
# 🔐 本番環境Slack Webhook URL
NOTIFICATION_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/PRODUCTION/WEBHOOK
# 🔐 本番環境Teams Webhook URL  
NOTIFICATION_TEAMS_WEBHOOK=https://outlook.office.com/webhook/YOUR-PRODUCTION-WEBHOOK

# SMS通知設定 (Twilio等)
SMS_PROVIDER=twilio
# 🔐 SMS送信認証情報
SMS_ACCOUNT_SID=PRODUCTION_TWILIO_ACCOUNT_SID
SMS_AUTH_TOKEN=PRODUCTION_TWILIO_AUTH_TOKEN
SMS_FROM_NUMBER=+1234567890

# ===== セキュリティ設定 (ISO 27002 完全準拠) =====
# HTTP Strict Transport Security (13.2.1)
SECURITY_HSTS_ENABLED=true
SECURITY_HSTS_MAX_AGE=31536000
SECURITY_HSTS_INCLUDE_SUBDOMAINS=true
SECURITY_HSTS_PRELOAD=true

# Content Security Policy (13.1.3) - 厳格設定
SECURITY_CSP_ENABLED=true
SECURITY_CSP_REPORT_ONLY=false
SECURITY_CSP_REPORT_URI=https://yourdomain.com/api/security/csp-report
SECURITY_CSP_DIRECTIVES="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self' https:; frame-ancestors 'none';"

# XSS Protection & Security Headers (13.1.3)
SECURITY_XSS_PROTECTION=true
SECURITY_FRAME_OPTIONS=DENY
SECURITY_CONTENT_TYPE_OPTIONS=nosniff
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin
SECURITY_PERMISSIONS_POLICY="geolocation=(), camera=(), microphone=()"

# セキュリティ監査・アクセス制御 (12.4.1, 9.4.2)
SECURITY_AUDIT_LOG_ENABLED=true
SECURITY_AUDIT_LOG_LEVEL=info
SECURITY_FAILED_LOGIN_ATTEMPTS_MAX=3
SECURITY_ACCOUNT_LOCKOUT_DURATION=3600
SECURITY_PASSWORD_HISTORY_SIZE=24
SECURITY_PASSWORD_MIN_LENGTH=16
SECURITY_PASSWORD_COMPLEXITY=true
SECURITY_PASSWORD_EXPIRY_DAYS=90

# 暗号化設定 (10.1.1)
SECURITY_ENCRYPTION_ALGORITHM=aes-256-gcm
SECURITY_ENCRYPTION_KEY_ROTATION_DAYS=60
# データベース暗号化キー
SECURITY_DB_ENCRYPTION_KEY=PRODUCTION_DATABASE_ENCRYPTION_KEY
# フィールドレベル暗号化
SECURITY_FIELD_ENCRYPTION_ENABLED=true

# 侵入検知・防御 (12.6.1)
SECURITY_IDS_ENABLED=true
SECURITY_INTRUSION_DETECTION=true
SECURITY_BRUTE_FORCE_PROTECTION=true
SECURITY_DDOS_PROTECTION=true

# セキュリティスキャン
SECURITY_VULNERABILITY_SCAN_ENABLED=true
SECURITY_DEPENDENCY_SCAN_ENABLED=true
SECURITY_SAST_ENABLED=true

# ===== コンプライアンス設定 (ISO 20000/27001) =====
COMPLIANCE_ISO20000_ENABLED=true
COMPLIANCE_ISO27001_ENABLED=true
COMPLIANCE_GDPR_ENABLED=true
# データ保持期間 (GDPR準拠)
COMPLIANCE_DATA_RETENTION_DAYS=2555
# 監査証跡保持
COMPLIANCE_AUDIT_RETENTION_DAYS=2555
# データ匿名化
COMPLIANCE_DATA_ANONYMIZATION=true

# ===== 災害復旧設定 (ISO 27002: 17.1.2) =====
DR_ENABLED=true
DR_BACKUP_LOCATION=s3://itsm-disaster-recovery/
DR_RTO_MINUTES=240
DR_RPO_MINUTES=60
# レプリケーション設定
DR_DB_REPLICATION_ENABLED=true
DR_CROSS_REGION_BACKUP=true

# ===== 本番環境運用設定 =====
PROD_CLUSTER_MODE=true
PROD_WORKERS=4
PROD_GRACEFUL_SHUTDOWN_TIMEOUT=30000
PROD_MEMORY_LIMIT=2048
PROD_CPU_LIMIT=2.0
PROD_AUTO_SCALING=true
PROD_MAX_INSTANCES=10
PROD_MIN_INSTANCES=2

# コンテンツ最適化
PROD_MINIFY=true
PROD_GZIP=true
PROD_CACHE_STATIC_ASSETS=true
PROD_CDN_ENABLED=true
PROD_CDN_URL=https://cdn.yourdomain.com

# ===== 外部サービス統合 =====
# Microsoft Graph API (本番環境)
GRAPH_API_CLIENT_ID=PRODUCTION_GRAPH_API_CLIENT_ID
GRAPH_API_CLIENT_SECRET=PRODUCTION_GRAPH_API_CLIENT_SECRET
GRAPH_API_TENANT_ID=PRODUCTION_GRAPH_API_TENANT_ID

# Active Directory統合
AD_ENABLED=true
AD_LDAP_URL=ldaps://ad.yourdomain.com:636
AD_BIND_DN=CN=ServiceAccount,OU=Service,DC=yourdomain,DC=com
AD_BIND_PASSWORD=PRODUCTION_AD_SERVICE_ACCOUNT_PASSWORD

# ===== 外部監視統合 =====
# New Relic
NEW_RELIC_ENABLED=true
NEW_RELIC_LICENSE_KEY=PRODUCTION_NEW_RELIC_LICENSE_KEY
NEW_RELIC_APP_NAME=itsm-production

# Datadog
DATADOG_ENABLED=true
DATADOG_API_KEY=PRODUCTION_DATADOG_API_KEY
DATADOG_APPLICATION_KEY=PRODUCTION_DATADOG_APPLICATION_KEY

# ===============================================================================
# デプロイ後チェックリスト:
# 
# □ 全機密値を実際の値に変更済み
# □ SSL証明書の設置・設定完了
# □ データベース接続テスト成功
# □ 外部サービスAPIキー設定完了
# □ メール送信テスト成功
# □ ログファイルの書き込み権限設定済み
# □ バックアップスクリプトのテスト完了
# □ 監視アラートの設定完了
# □ セキュリティヘッダーの動作確認済み
# □ パフォーマンステスト完了
# □ 災害復旧手順のテスト完了
# □ セキュリティ脆弱性スキャン完了
# □ コンプライアンス要件チェック完了
#
# セキュリティ検証:
# python scripts/security_validator.py --env-file .env.production
#
# ===============================================================================