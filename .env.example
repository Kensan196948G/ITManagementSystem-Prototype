# ITサービス管理システム - 環境設定
# ===============================================================================
# SECURITY WARNING: このファイルは本番環境では使用しないでください
# 本番環境では .env.production.example を使用してください
# ===============================================================================
#
# セキュリティ要件 (ISO 27001/27002 準拠):
# - 全ての機密値は強力なランダム値に変更してください
# - 本番環境では HTTPS を必須とする
# - 定期的なキーローテーション (90日ごと推奨)
# - 監査ログを有効化する
#
# キー生成方法:
# JWT_SECRET: openssl rand -base64 64
# SESSION_SECRET: openssl rand -base64 32
# CSRF_SECRET: openssl rand -base64 32
#
# ===============================================================================

# ===== アプリケーション基本設定 =====
NODE_ENV=development
APP_NAME="IT Management System"
APP_VERSION=1.0.0
# 本番環境では false に設定
APP_DEBUG=true
APP_LOG_LEVEL=info

# ===== サーバー設定 =====
SERVER_HOST=localhost
SERVER_PORT=3000
# 本番環境では true に設定 (ISO 27002: 13.2.1 情報転送ポリシー)
SERVER_HTTPS_ENABLED=false
SERVER_SSL_CERT_PATH=./certs/server.crt
SERVER_SSL_KEY_PATH=./certs/server.key
SERVER_CORS_ORIGIN=http://localhost:3000
SERVER_BODY_LIMIT=50mb
# タイムアウト設定でDoS攻撃を防止
SERVER_REQUEST_TIMEOUT=30000

# ===== データベース設定 =====
# PostgreSQL 設定
DB_TYPE=postgresql
DB_HOST=localhost
DB_PORT=5432
DB_NAME=itsm_dev
DB_USERNAME=postgres
# SECURITY: 強力なパスワードを設定してください (最低12文字、英数字記号混在)
DB_PASSWORD=CHANGE_ME_TO_STRONG_PASSWORD_MIN_12_CHARS
DB_SCHEMA=public
# 本番環境では true に設定
DB_SSL=false
DB_SSL_REJECT_UNAUTHORIZED=false

# 接続プール設定
DB_POOL_MIN=2
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT=10000
DB_POOL_ACQUIRE_TIMEOUT=30000
DB_POOL_CREATE_TIMEOUT=30000
DB_POOL_DESTROY_TIMEOUT=5000

# マイグレーション設定
DB_MIGRATIONS_RUN=true
DB_MIGRATIONS_TABLE=migrations
DB_MIGRATIONS_DIR=./src/database/migrations

# バックアップ設定
DB_BACKUP_ENABLED=true
DB_BACKUP_SCHEDULE="0 2 * * *"
DB_BACKUP_RETENTION_DAYS=30
DB_BACKUP_PATH=./backups

# ===== 認証・セキュリティ設定 =====
# CRITICAL SECURITY: 以下の値は必ず変更してください
# 生成コマンド例: openssl rand -base64 64
JWT_SECRET=CHANGE_ME_GENERATED_JWT_SECRET_BASE64_MIN_64_CHARS
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d
# BCryptラウンド数 (ISO 27002: 10.1.1 暗号化制御ポリシー)
BCRYPT_ROUNDS=12
# セッション秘密鍵: openssl rand -base64 32
SESSION_SECRET=CHANGE_ME_GENERATED_SESSION_SECRET_BASE64_32_CHARS
# CSRF保護秘密鍵: openssl rand -base64 32  
CSRF_SECRET=CHANGE_ME_GENERATED_CSRF_SECRET_BASE64_32_CHARS

# Multi-Factor Authentication (MFA)
MFA_ENABLED=false
MFA_ISSUER_NAME="IT Management System"
MFA_SECRET_LENGTH=32

# OAuth設定 (機密情報 - Azure AD/Google Console から取得)
OAUTH_GOOGLE_CLIENT_ID=REPLACE_WITH_GOOGLE_CLIENT_ID
OAUTH_GOOGLE_CLIENT_SECRET=REPLACE_WITH_GOOGLE_CLIENT_SECRET
OAUTH_MICROSOFT_CLIENT_ID=REPLACE_WITH_MICROSOFT_CLIENT_ID
OAUTH_MICROSOFT_CLIENT_SECRET=REPLACE_WITH_MICROSOFT_CLIENT_SECRET
OAUTH_MICROSOFT_TENANT_ID=REPLACE_WITH_MICROSOFT_TENANT_ID

# ===== 外部サービス設定 =====
# メール設定
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
SMTP_FROM="IT Management System <noreply@yourcompany.com>"
EMAIL_TIMEOUT=10000

# ファイルストレージ設定 (ISO 27002: 8.1.3 メディアの取扱い)
STORAGE_TYPE=local
STORAGE_LOCAL_PATH=./uploads
STORAGE_MAX_FILE_SIZE=10485760
STORAGE_ALLOWED_EXTENSIONS=jpg,jpeg,png,pdf,doc,docx,xls,xlsx,txt
STORAGE_ENCRYPT_AT_REST=true
# AWS S3 設定 (オプション)
STORAGE_AWS_REGION=us-east-1
STORAGE_AWS_BUCKET=REPLACE_WITH_S3_BUCKET_NAME
STORAGE_AWS_ACCESS_KEY=REPLACE_WITH_AWS_ACCESS_KEY
STORAGE_AWS_SECRET_KEY=REPLACE_WITH_AWS_SECRET_KEY
STORAGE_AWS_KMS_KEY_ID=REPLACE_WITH_KMS_KEY_ID

# Redis設定
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_TIMEOUT=5000
REDIS_RETRY_DELAY=100
REDIS_RETRY_ATTEMPTS=3

# ===== API設定 =====
# 外部API設定
API_BASE_URL=http://localhost:3000/api
API_TIMEOUT=15000
API_RETRY_ATTEMPTS=3
API_RETRY_DELAY=1000

# レート制限設定
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_SKIP_SUCCESS=false

# ===== ログ設定 =====
LOG_LEVEL=info
LOG_FORMAT=combined
LOG_FILE_ENABLED=true
LOG_FILE_PATH=./logs/app.log
LOG_FILE_MAX_SIZE=10m
LOG_FILE_MAX_FILES=14
LOG_CONSOLE_ENABLED=true
LOG_ERROR_FILE=./logs/error.log

# ===== 監視・メトリクス設定 =====
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH=/metrics
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# ===== 機能フラグ設定 =====
FEATURE_USER_REGISTRATION=true
FEATURE_EMAIL_VERIFICATION=true
FEATURE_TWO_FACTOR_AUTH=false
FEATURE_AUDIT_LOG=true
FEATURE_NOTIFICATIONS=true
FEATURE_ANALYTICS=true
FEATURE_AUTO_BACKUP=true

# ===== キャッシュ設定 =====
CACHE_TYPE=memory
CACHE_TTL=3600
CACHE_MAX_SIZE=100
CACHE_REDIS_PREFIX=itsm:

# ===== セッション設定 =====
SESSION_STORE=memory
SESSION_MAX_AGE=86400000
SESSION_SECURE=false
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=lax

# ===== ファイルアップロード設定 =====
UPLOAD_MAX_SIZE=10485760
UPLOAD_ALLOWED_TYPES=jpg,jpeg,png,pdf,doc,docx,xls,xlsx
UPLOAD_DESTINATION=./uploads
UPLOAD_TEMP_DIR=./temp

# ===== 通知設定 =====
NOTIFICATION_EMAIL_ENABLED=true
NOTIFICATION_SMS_ENABLED=false
NOTIFICATION_PUSH_ENABLED=true
NOTIFICATION_SLACK_WEBHOOK=
NOTIFICATION_TEAMS_WEBHOOK=

# ===== セキュリティ設定 (ISO 27002 準拠) =====
# HTTP Strict Transport Security (13.2.1)
SECURITY_HSTS_ENABLED=true
SECURITY_HSTS_MAX_AGE=31536000
SECURITY_HSTS_INCLUDE_SUBDOMAINS=true
SECURITY_HSTS_PRELOAD=true

# Content Security Policy (13.1.3)
SECURITY_CSP_ENABLED=true
SECURITY_CSP_REPORT_ONLY=false
SECURITY_CSP_REPORT_URI=/api/security/csp-report

# XSS Protection (13.1.3)
SECURITY_XSS_PROTECTION=true
SECURITY_FRAME_OPTIONS=DENY
SECURITY_CONTENT_TYPE_OPTIONS=nosniff
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin

# セキュリティ監査・ログ (12.4.1)
SECURITY_AUDIT_LOG_ENABLED=true
SECURITY_AUDIT_LOG_LEVEL=info
SECURITY_FAILED_LOGIN_ATTEMPTS_MAX=5
SECURITY_ACCOUNT_LOCKOUT_DURATION=1800
SECURITY_PASSWORD_HISTORY_SIZE=12
SECURITY_PASSWORD_MIN_LENGTH=12
SECURITY_PASSWORD_COMPLEXITY=true

# Encryption (10.1.1)
SECURITY_ENCRYPTION_ALGORITHM=aes-256-gcm
SECURITY_ENCRYPTION_KEY_ROTATION_DAYS=90

# ===== 開発専用設定 =====
DEV_HOT_RELOAD=true
DEV_SOURCE_MAPS=true
DEV_MOCK_DATA=true
DEV_AUTO_MIGRATE=true

# ===== テスト設定 =====
TEST_DB_HOST=localhost
TEST_DB_PORT=5432
TEST_DB_NAME=itsm_test
TEST_TIMEOUT=30000
TEST_PARALLEL=true

# ===== 本番環境設定 =====
PROD_MINIFY=true
PROD_GZIP=true
PROD_CLUSTER_WORKERS=0
PROD_GRACEFUL_SHUTDOWN_TIMEOUT=10000